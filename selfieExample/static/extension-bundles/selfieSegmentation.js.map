{"version":3,"file":"selfieSegmentation.js","sources":["../../../../extensions/scripts/node_modules/tslib/tslib.es6.js","../../../../extensions/src/selfieSegmentation/MockBitmapAdapter.ts","../../../../extensions/src/selfieSegmentation/utils.ts","../../../../extensions/src/selfieSegmentation/index.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.push(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.push(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n","/**\n * Class adapted from: https://github.com/LLK/scratch-svg-renderer/blob/develop/src/bitmap-adapter.js\n */\nexport default class {\n  private makeImage() { return new Image() }\n  private makeCanvas() { return document.createElement('canvas') }\n\n  /**\n   * Return a canvas with the resized version of the given image, done using nearest-neighbor interpolation\n   * @param {CanvasImageSource} image The image to resize\n   * @param {int} newWidth The desired post-resize width of the image\n   * @param {int} newHeight The desired post-resize height of the image\n   * @returns {HTMLCanvasElement} A canvas with the resized image drawn on it.\n   */\n  resize(image, newWidth, newHeight) {\n    // We want to always resize using nearest-neighbor interpolation. However, canvas implementations are free to\n    // use linear interpolation (or other \"smooth\" interpolation methods) when downscaling:\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=1360415\n    // It seems we can get around this by resizing in two steps: first width, then height. This will always result\n    // in nearest-neighbor interpolation, even when downscaling.\n    const stretchWidthCanvas = this.makeCanvas();\n    stretchWidthCanvas.width = newWidth;\n    stretchWidthCanvas.height = image.height;\n    let context = stretchWidthCanvas.getContext('2d');\n    context.imageSmoothingEnabled = false;\n    context.drawImage(image, 0, 0, stretchWidthCanvas.width, stretchWidthCanvas.height);\n    const stretchHeightCanvas = this.makeCanvas();\n    stretchHeightCanvas.width = newWidth;\n    stretchHeightCanvas.height = newHeight;\n    context = stretchHeightCanvas.getContext('2d');\n    context.imageSmoothingEnabled = false;\n    context.drawImage(stretchWidthCanvas, 0, 0, stretchHeightCanvas.width, stretchHeightCanvas.height);\n    return stretchHeightCanvas;\n  }\n\n  /**\n   * Scratch 2.0 had resolution 1 and 2 bitmaps. All bitmaps in Scratch 3.0 are equivalent\n   * to resolution 2 bitmaps. Therefore, converting a resolution 1 bitmap means doubling\n   * it in width and height.\n   * @param {!string} dataURI Base 64 encoded image data of the bitmap\n   * @param {!function} callback Node-style callback that returns updated dataURI if conversion succeeded\n   */\n  convertResolution1Bitmap(dataURI, callback) {\n    const image = new Image();\n    image.src = dataURI;\n    image.onload = () => {\n      callback(null, this.resize(image, image.width * 2, image.height * 2).toDataURL());\n    };\n    image.onerror = () => {\n      callback('Image load failed');\n    };\n  }\n\n  /**\n   * Given width/height of an uploaded item, return width/height the image will be resized\n   * to in Scratch 3.0\n   * @param {!number} oldWidth original width\n   * @param {!number} oldHeight original height\n   * @return {object} Array of new width, new height\n   */\n  getResizedWidthHeight(oldWidth, oldHeight) {\n    const STAGE_WIDTH = 480;\n    const STAGE_HEIGHT = 360;\n    const STAGE_RATIO = STAGE_WIDTH / STAGE_HEIGHT;\n\n    // If both dimensions are smaller than or equal to corresponding stage dimension,\n    // double both dimensions\n    if ((oldWidth <= STAGE_WIDTH) && (oldHeight <= STAGE_HEIGHT)) {\n      return { width: oldWidth * 2, height: oldHeight * 2 };\n    }\n\n    // If neither dimension is larger than 2x corresponding stage dimension,\n    // this is an in-between image, return it as is\n    if ((oldWidth <= STAGE_WIDTH * 2) && (oldHeight <= STAGE_HEIGHT * 2)) {\n      return { width: oldWidth, height: oldHeight };\n    }\n\n    const imageRatio = oldWidth / oldHeight;\n    // Otherwise, figure out how to resize\n    if (imageRatio >= STAGE_RATIO) {\n      // Wide Image\n      return { width: STAGE_WIDTH * 2, height: STAGE_WIDTH * 2 / imageRatio };\n    }\n    // In this case we have either:\n    // - A wide image, but not with as big a ratio between width and height,\n    // making it so that fitting the width to double stage size would leave\n    // the height too big to fit in double the stage height\n    // - A square image that's still larger than the double at least\n    // one of the stage dimensions, so pick the smaller of the two dimensions (to fit)\n    // - A tall image\n    // In any of these cases, resize the image to fit the height to double the stage height\n    return { width: STAGE_HEIGHT * 2 * imageRatio, height: STAGE_HEIGHT * 2 };\n  }\n\n  /**\n   * Given bitmap data, resize as necessary.\n   * @param {string} fileData Base 64 encoded image data of the bitmap\n   * @param {string} fileType The MIME type of this file\n   * @returns {Promise} Resolves to resized image data Uint8Array\n   */\n  importBitmap(dataURI: string): Promise<Uint8Array> {\n    return new Promise((resolve, reject) => {\n      const image = this.makeImage();\n      image.src = dataURI;\n      image.onload = () => {\n        const newSize = this.getResizedWidthHeight(image.width, image.height);\n        if (newSize.width === image.width && newSize.height === image.height) {\n          // No change\n          resolve(this.convertDataURIToBinary(dataURI));\n        } else {\n          const resizedDataURI = this.resize(image, newSize.width, newSize.height).toDataURL();\n          resolve(this.convertDataURIToBinary(resizedDataURI));\n        }\n      };\n      image.onerror = () => {\n        reject('Image load failed :(');\n      };\n    });\n  }\n\n  // TODO consolidate with scratch-vm/src/util/base64-util.js\n  // From https://gist.github.com/borismus/1032746\n  convertDataURIToBinary(dataURI) {\n    const BASE64_MARKER = ';base64,';\n    const base64Index = dataURI.indexOf(BASE64_MARKER) + BASE64_MARKER.length;\n    const base64 = dataURI.substring(base64Index);\n    const raw = window.atob(base64);\n    const rawLength = raw.length;\n    const array = new Uint8Array(new ArrayBuffer(rawLength));\n\n    for (let i = 0; i < rawLength; i++) {\n      array[i] = raw.charCodeAt(i);\n    }\n    return array;\n  }\n}","import { untilExternalGlobalVariableLoaded } from \"$common\";\nimport type Runtime from \"$scratch-vm/engine/runtime\";\nimport { ResultsListener, type Results, type SelfieSegmentation } from \"@mediapipe/selfie_segmentation\";\nimport MockBitmapAdapter from \"./MockBitmapAdapter\";\nimport type Tesseract from \"tesseract.js\";\n\nexport const getImageHelper = (width, height) => {\n  const canvas = document.body.appendChild(document.createElement(\"canvas\"));\n  canvas.hidden = true;\n  canvas.width = width;\n  canvas.height = height;\n  const context = canvas.getContext(\"2d\");\n\n  return {\n    /**\n     * \n     * @param mask \n     * @param color \n     * @returns \n     */\n    colorIn(mask: ImageBitmap, color: string) {\n      context.save();\n      context.clearRect(0, 0, width, height);\n      context.drawImage(mask, 0, 0);\n      context.globalCompositeOperation = 'source-in';\n      context.fillStyle = color;\n      context.fillRect(0, 0, canvas.width, canvas.height);\n      context.restore();\n      return context.getImageData(0, 0, width, height);\n    },\n    /**\n     * \n     * @param image \n     * @param mask \n     * @returns \n     */\n    getMasked(image: ImageBitmap, mask: ImageBitmap) {\n      context.save();\n      context.clearRect(0, 0, width, height);\n      context.drawImage(mask, 0, 0);\n      context.globalCompositeOperation = 'source-in';\n      context.fillStyle = \"white\";\n      context.fillRect(0, 0, canvas.width, canvas.height);\n      context.drawImage(image, 0, 0);\n      context.restore();\n      return context.getImageData(0, 0, width, height);\n    },\n    /**\n     * \n     * @param image \n     * @returns \n     */\n    getDataURL(image: ImageData) {\n      context.save();\n      context.clearRect(0, 0, width, height);\n      context.putImageData(image, 0, 0);\n      const url = canvas.toDataURL('image/png');\n      context.restore();\n      return url;\n    }\n  }\n}\n\nexport const getSelfieModel = async (onFrame: ResultsListener) => {\n  const packageURL = \"https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js\";\n  const packageClassName = \"SelfieSegmentation\";\n\n  // Load the media pipe script from an external source to get around the following bug: https://github.com/vitejs/vite/issues/4680\n  // TODO: Revist this once rollup-plugin-esbuild supports Typescript 5.0\n  const Class = await untilExternalGlobalVariableLoaded<typeof SelfieSegmentation>(packageURL, packageClassName);\n\n  const model = new Class({\n    locateFile: (file) => {\n      return `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation@0.1/${file}`;\n    }\n  });\n  // Initialize the mediaPipe model according to the documentation\n  model.setOptions({ modelSelection: 1 });\n  model.onResults(onFrame);\n  await model.initialize();\n\n  return model;\n}\n\n\nexport const getTesseract = async () => {\n  const packageURL = \"https://unpkg.com/tesseract.js@4.0.2/dist/tesseract.min.js\";\n  const packageClassName = \"Tesseract\";\n\n  const img = document.createElement('img');\n  img.hidden = true;\n\n  const tesseract = await untilExternalGlobalVariableLoaded<typeof Tesseract>(packageURL, packageClassName);\n  function imageToText(language: string, imageUrl: string) {\n    img.src = imageUrl;\n    return tesseract.recognize(\n      img,\n      language,\n      { logger: m => console.log(m) }\n    ).then(({ data: { text } }) => {\n      return text;\n    })\n  }\n  return imageToText;\n}\n\nlet bitmapAdapter: MockBitmapAdapter;\n\nexport const createCostumeAssetFromImage = async (dataURL: string, runtime: Runtime) => {\n  bitmapAdapter ??= new MockBitmapAdapter();\n\n  // storage is of type: https://github.com/LLK/scratch-storage/blob/develop/src/ScratchStorage.js\n  const storage = runtime.storage;\n  const costumeFormat = storage.DataFormat.PNG;\n  const assetType = storage.AssetType.ImageBitmap;\n\n  const dataBuffer = await bitmapAdapter.importBitmap(dataURL);\n\n  const asset = storage.createAsset(\n    assetType,\n    costumeFormat,\n    dataBuffer,\n    null,\n    true // generate md5\n  );\n\n  return {\n    name: null, // Needs to be set by caller\n    dataFormat: costumeFormat,\n    asset: asset,\n    md5: `${asset.assetId}.${costumeFormat}`,\n    assetId: asset.assetId\n  };\n}","//Parker Malachowsky\n//Gur Machol\n\nimport { ExtensionMenuDisplayDetails, extension, block, untilTimePassed, RGBObject, rgbToHex, Language } from \"$common\";\nimport { type Results, type SelfieSegmentation } from \"@mediapipe/selfie_segmentation\";\nimport { createCostumeAssetFromImage, getImageHelper, getSelfieModel, getTesseract } from \"./utils\";\nimport type BlockUtility from \"$scratch-vm/engine/block-utility\";\nimport type RenderedTarget from \"$scratch-vm/sprites/rendered-target\";\n\n\n//add angle field and rotate image before costume\n//block to take x photos in x seconds \n\n//more langauges can always be added at a later time as long as both lists are edited. \n//list of languages and codes: https://github.com/naptha/tesseract.js\nlet langOptions: Array<string> = [\"Arabic\", \"Chinese - Simplified\", \"German\", \"English\", \"French\", \"Hebrew\", \"Japanese\", \"Russian\", \"Swedish\"];\nlet langCodes: Array<string> = [\"ara\", \"chi_sim\", \"deu\", \"eng\", \"fra\", \"heb\", \"jpn\", \"rus\", \"swe\"];\n\n//setting up the face of the extension \nconst details: ExtensionMenuDisplayDetails = {\n  name: \"Selfie Detector\",\n  description: \"Extension to create costumes for sprites from your very own webcam!\",\n  iconURL: \"Gur_Projectdesign.jpg\",\n};\n\n//small function to make ts wait for a user specified amount of time\nfunction sleep(milliseconds) {\n  const date = Date.now();\n  let currentDate = null;\n  do {\n    currentDate = Date.now();\n  } while (currentDate - date < milliseconds);\n}\n\nexport default class extends extension(details, \"video\", \"drawable\") {\n  // A reference to the mediapipe SelfieSegmentation class doing all the work\n  model: SelfieSegmentation;\n\n\n  /**\n   * Whether or not the extension should currently be processing selfies\n   */\n  processing: boolean;\n\n  /**\n   * An to the items being drawn on screen\n   */\n  drawables: ReturnType<typeof this.createDrawable>[] = [];\n\n  /**\n   * Current drawing method.\n   * - Mask: Mask-out the selfie region of the original image\n   * - Color: Draw the selfi region as a single color\n   */\n  mode: \"mask\" | \"color\" = \"mask\";\n\n  /**\n   * How many 'echo' images to preserve on screen\n   */\n  echoLength: number = 0;\n\n  /**\n   * Ideal processing time for each selfie\n   */\n  processFrequencyMs: number = 100;\n\n  /**\n   * Color used to fill in selfie region when mode = \"color\"\n   */\n  color: string;\n\n  /**\n   * Helper object for using and manipulating the ouputs of the model\n   */\n  imageHelper: ReturnType<typeof getImageHelper>;\n\n  getTesseractInfrence: Awaited<ReturnType<typeof getTesseract>>;\n\n  lastProcessedImage: ImageData;\n\n\n  async init() {\n    this.enableVideo();\n    this.model = await getSelfieModel((results) => this.processResults(results));\n    this.start();\n    this.getTesseractInfrence = await getTesseract();\n  }\n\n  private processResults(results: Results) {\n    const image = results.image as ImageBitmap;\n    const mask = results.segmentationMask as ImageBitmap;\n    const { width, height } = mask;\n\n    this.imageHelper ??= getImageHelper(width, height);\n\n    const { drawables, mode, imageHelper, color } = this;\n\n    const toDraw = mode === \"color\" ? imageHelper.colorIn(mask, color) : imageHelper.getMasked(image, mask);\n\n    this.lastProcessedImage = toDraw;\n\n    if (this.echoLength <= 0) {\n      drawables.length === 0 ? drawables.push(this.createDrawable(toDraw)) : drawables[0].update(toDraw);\n      return;\n    }\n\n    while (drawables.length > this.echoLength) drawables.shift().destroy();\n\n    drawables.forEach((drawable, index, { length }) => drawable.setTransparency(100 * ((length - index) / length)));\n    drawables.push(this.createDrawable(toDraw));\n  }\n\n  private start() {\n    if (this.processing) return;\n    this.processing = true;\n    this.loop();\n  }\n\n  private stop() {\n    this.processing = false;\n    this.clearDrawables();\n  }\n\n  private async loop() {\n    while (this.processing) {\n      const image = this.getVideoFrame(\"canvas\");\n      const start = Date.now();\n      if (image) await this.model.send({ image });\n      const elapsed = Date.now() - start;\n      await untilTimePassed(this.processFrequencyMs - elapsed);\n    }\n  }\n\n  private clearDrawables() {\n    this.drawables.forEach(drawable => drawable.destroy());\n    this.drawables = [];\n  }\n\n  @block({\n    type: \"command\",\n    text: `Set selfie image as costume`,\n  })\n  async setCostume(util: BlockUtility) {\n    const buffer = this.imageHelper.getDataURL(this.lastProcessedImage);\n    const costume = await createCostumeAssetFromImage(buffer, this.runtime);\n    costume.name = `${this.id}_generated_${Date.now()}`;\n    const renderedTarget = util.target as any as RenderedTarget;\n    const { length } = renderedTarget.getCostumes();\n    await this.runtime.addCostume(costume);\n    renderedTarget.addCostume(costume, length);\n    renderedTarget.setCostume(length);\n  }\n  /*\n  @block({\n    type: \"command\",\n    arg: \"number\"\n    text: (degree) =>`Set selfie image as costume rotated ${degree} degrees`,\n  })\n  async setCostumeAndRotaion(util: BlockUtility, degree: number) {\n    const buffer = this.imageHelper.getDataURL(this.lastProcessedImage);\n    const costume = await createCostumeAssetFromImage(buffer, this.runtime);\n    costume.name = `${this.id}_generated_${Date.now()}`;\n    const renderedTarget = util.target as any as RenderedTarget;\n    const { length } = renderedTarget.getCostumes();\n    await this.runtime.addCostume(costume);\n    renderedTarget.addCostume(costume, length);\n    renderedTarget.setCostume(length);\n  }\n  */\n  //sets video transparency \n  @block({\n    type: \"command\",\n    text: (x) => `Set video feed transparency to ${x}%`,\n    arg: \"number\"\n  })\n  setVideoFeedTransparency(transparency: number) {\n    this.setVideoTransparency(transparency);\n  }\n\n  //masks the user with a color so they can see what is being segmented.\n  @block({\n    type: \"command\",\n    text: (mode) => `Set mode to ${mode}`,\n    arg: { type: \"string\", options: [\"color\", \"mask\"], defaultValue: \"mask\" }\n  })\n  setDisplayMode(mode: typeof this.mode) {\n    this.clearDrawables();\n    this.mode = mode;\n  }\n\n  @block({\n    type: \"command\",\n    text: (num) => `Set echo count to ${num}`,\n    arg: {\n      type: \"number\",\n      defaultValue: 0,\n      options: {\n        items: [0, 1, 2, 4, 8, 10, 25, 50, 100],\n        acceptsReporters: true,\n        handler: (x) => {\n          const parsed = parseInt(`${x}`);\n          return isNaN(parsed) ? 1 : parsed;\n        }\n      }\n    }\n  })\n  setNumberOfEchos(num: number) {\n    this.echoLength = Math.min(100, Math.max(num, 1));\n  }\n\n  @block({\n    type: \"command\",\n    text: (color) => `Set fill color to ${color}`,\n    arg: \"color\"\n  })\n  setColor(color: RGBObject) {\n    this.color = rgbToHex(color);\n  }\n\n  @block((self) => ({\n    type: \"command\",\n    text: (fps) => `Set processing rate to ${fps} fps`,\n    arg: {\n      type: \"number\",\n      options: [60, 30, 10, 2, 1],\n      defaultValue: 1000 / self.processFrequencyMs\n    } as const\n  }))\n  setFrameRate(fps: number) {\n    this.processFrequencyMs = 1000 / fps\n  }\n\n  @block({\n    \"type\": \"command\",\n    text: (state) => `Turn processing ${state}`,\n    arg: { type: \"string\", options: [\"on\", \"off\"] }\n  })\n  setProcessingState(state: \"on\" | \"off\") {\n    state === \"on\" ? this.start() : this.stop();\n  }\n\n  @block({\n    \"type\": \"command\",\n    text: (state) => `Turn camera ${state}`,\n    arg: { type: \"string\", options: [\"on\", \"off\"] }\n  })\n  cameraSet(state: \"on\" | \"off\") {\n    if (state == \"on\"){\n      this.enableVideo();\n    }\n    else if(state == \"off\"){\n      this.disableVideo();\n    }\n  }\n\n  @block({\n    type: \"command\",\n    text: (numberOfPics: number, seconds: number) => `Make ${numberOfPics} selfie images into costumes in ${seconds} seconds`,\n    args: [{ type: \"number\" }, { type: \"number\" }],\n  })\n  async xCostumesxSeconds(numberOfPics: number, seconds: number, util: BlockUtility) {\n    for (let x = 0; x <= numberOfPics; x++) {\n      const buffer = this.imageHelper.getDataURL(this.lastProcessedImage);\n      const costume = await createCostumeAssetFromImage(buffer, this.runtime);\n      costume.name = `${this.id}_generated_${Date.now()}`;\n      const renderedTarget = util.target as any as RenderedTarget;\n      const { length } = renderedTarget.getCostumes();\n      await this.runtime.addCostume(costume);\n      renderedTarget.addCostume(costume, length);\n      renderedTarget.setCostume(length);\n      sleep((seconds * 1000 + 10) / numberOfPics);\n    }\n\n  }\n  @block({\n    type: \"reporter\",\n    text: \"Text recognized in image\",\n  })\n  async generateText() {\n    let imageText = await this.getTesseractInfrence(\"eng\", this.imageHelper.getDataURL(this.getVideoFrame(\"image\")));\n    return imageText;\n  }\n\n  @block({\n    type: \"reporter\",\n    arg: {type: \"string\", options: langOptions},\n    text: (language) => `Text recognized in ${language}`,\n  })\n  async generateTextWLanguage(language:string){\n    let langchoice = langOptions.indexOf(language);\n    let langCode = langCodes[langchoice];\n    let imageText = await this.getTesseractInfrence(langCode, this.imageHelper.getDataURL(this.getVideoFrame(\"image\")));\n    return imageText;\n  }\n\n  @block({\n    type: \"command\",\n    text: (condition) => `Flip video ${condition}`,\n    arg: { type: \"Boolean\", options: [true, false] }\n  })\n  flipVideoBlock(doFlip: boolean) {\n    this.flipVideo(!doFlip)\n  }\n\n  \n\n  @block({\n    type: \"button\",\n    text: \"Take a picture: open UI\"\n  })\n  TxtDetecUI(){\n\n  }\n  \n}"],"names":["selfieSegmentation","exports","$common","__esDecorate","ctor","descriptorIn","decorators","contextIn","initializers","extraInitializers","accept","f","TypeError","_","kind","key","target","prototype","descriptor","Object","getOwnPropertyDescriptor","name","done","i","length","context","p","access","addInitializer","push","result","get","set","init","defineProperty","MockBitmapAdapter","makeImage","Image","makeCanvas","document","createElement","resize","image","newWidth","newHeight","stretchWidthCanvas","this","width","height","getContext","imageSmoothingEnabled","drawImage","stretchHeightCanvas","convertResolution1Bitmap","dataURI","callback","src","onload","toDataURL","onerror","getResizedWidthHeight","oldWidth","oldHeight","STAGE_WIDTH","STAGE_HEIGHT","imageRatio","importBitmap","Promise","resolve","reject","newSize","convertDataURIToBinary","resizedDataURI","BASE64_MARKER","base64Index","indexOf","base64","substring","raw","window","atob","rawLength","array","Uint8Array","ArrayBuffer","charCodeAt","bitmapAdapter","createCostumeAssetFromImage","async","dataURL","runtime","storage","costumeFormat","DataFormat","PNG","assetType","AssetType","ImageBitmap","dataBuffer","asset","createAsset","dataFormat","md5","assetId","langOptions","langCodes","details","description","iconURL","index","_a","extension","model","thisArg","value","useValue","arguments","call","__runInitializers","_instanceExtraInitializers","drawables","mode","echoLength","processFrequencyMs","enableVideo","onFrame","untilExternalGlobalVariableLoaded","locateFile","file","setOptions","modelSelection","onResults","initialize","getSelfieModel","results","processResults","start","getTesseractInfrence","img","hidden","tesseract","language","imageUrl","recognize","logger","m","console","log","then","data","text","getTesseract","mask","segmentationMask","imageHelper","canvas","body","appendChild","colorIn","color","save","clearRect","globalCompositeOperation","fillStyle","fillRect","restore","getImageData","getMasked","getDataURL","putImageData","url","getImageHelper","toDraw","lastProcessedImage","createDrawable","update","shift","destroy","forEach","drawable","setTransparency","processing","loop","stop","clearDrawables","getVideoFrame","Date","now","send","elapsed","untilTimePassed","util","buffer","costume","id","renderedTarget","getCostumes","addCostume","setCostume","setVideoFeedTransparency","transparency","setVideoTransparency","setDisplayMode","setNumberOfEchos","num","Math","min","max","setColor","rgbToHex","setFrameRate","fps","setProcessingState","state","cameraSet","disableVideo","numberOfPics","seconds","x","langchoice","langCode","flipVideoBlock","doFlip","flipVideo","TxtDetecUI","concat","configurable","prefix","_setCostume_decorators","block","type","_setVideoFeedTransparency_decorators","arg","_setDisplayMode_decorators","options","defaultValue","_setNumberOfEchos_decorators","items","acceptsReporters","handler","parsed","parseInt","isNaN","_setColor_decorators","_setFrameRate_decorators","self","_setProcessingState_decorators","_cameraSet_decorators","_xCostumesxSeconds_decorators","args","_generateText_decorators","_generateTextWLanguage_decorators","_flipVideoBlock_decorators","condition","_TxtDetecUI_decorators","static","private","has","obj","xCostumesxSeconds","generateText","generateTextWLanguage","Extension","ExtensionFramework"],"mappings":"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"}