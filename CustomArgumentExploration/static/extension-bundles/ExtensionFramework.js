var ExtensionFramework=function(t){"use strict";const e={Boolean:"Boolean",Button:"button",Command:"command",Conditional:"conditional",Event:"event",Hat:"hat",Loop:"loop",Reporter:"reporter"},r={Angle:"angle",Boolean:"Boolean",Color:"color",Number:"number",String:"string",Matrix:"matrix",Note:"note",Image:"image"},n={BackgroundLayer:"background",VideoLayer:"video",PenLayer:"pen",SpriteLayer:"sprite"},i=[n.VideoLayer,n.SpriteLayer,n.BackgroundLayer,n.PenLayer],a={"Аҧсшәа":"ab","العربية":"ar","አማርኛ":"am",Azeri:"az",Bahasa_Indonesia:"id","Беларуская":"be","Български":"bg","Català":"ca","Česky":"cs",Cymraeg:"cy",Dansk:"da",Deutsch:"de",Eesti:"et","Ελληνικά":"el",English:"en","Español":"es","Español_Latinoamericano":"es-419",Euskara:"eu","فارسی":"fa","Français":"fr",Gaeilge:"ga","Gàidhlig":"gd",Galego:"gl","한국어":"ko","עִבְרִית":"he",Hrvatski:"hr",isiZulu:"zu","Íslenska":"is",Italiano:"it","ქართული_ენა":"ka",Kiswahili:"sw","Kreyòl_ayisyen":"ht","کوردیی_ناوەندی":"ckb","Latviešu":"lv","Lietuvių":"lt",Magyar:"hu","Māori":"mi",Nederlands:"nl","日本語":"ja","にほんご":"ja-Hira","Norsk_Bokmål":"nb",Norsk_Nynorsk:"nn","Oʻzbekcha":"uz","ไทย":"th","ភាសាខ្មែរ":"km",Polski:"pl","Português":"pt","Português_Brasileiro":"pt-br",Rapa_Nui:"rap","Română":"ro","Русский":"ru","Српски":"sr","Slovenčina":"sk","Slovenščina":"sl",Suomi:"fi",Svenska:"sv","Tiếng_Việt":"vi","Türkçe":"tr","Українська":"uk","简体中文":"zh-cn","繁體中文":"zh-tw"},o=Object.keys(a);class s{static get RGB_BLACK(){return{r:0,g:0,b:0}}static get RGB_WHITE(){return{r:255,g:255,b:255}}static decimalToHex(t){t<0&&(t+=16777216);let e=Number(t).toString(16);return e=`#${"000000".substr(0,6-e.length)}${e}`,e}static decimalToRgb(t){const e=t>>24&255;return{r:t>>16&255,g:t>>8&255,b:255&t,a:e>0?e:255}}static hexToRgb(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((t,e,r,n)=>e+e+r+r+n+n));const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}static rgbToHex(t){return s.decimalToHex(s.rgbToDecimal(t))}static rgbToDecimal(t){return(t.r<<16)+(t.g<<8)+t.b}static hexToDecimal(t){return s.rgbToDecimal(s.hexToRgb(t))}static hsvToRgb(t){let e=t.h%360;e<0&&(e+=360);const r=Math.max(0,Math.min(t.s,1)),n=Math.max(0,Math.min(t.v,1)),i=Math.floor(e/60),a=e/60-i,o=n*(1-r),s=n*(1-r*a),c=n*(1-r*(1-a));let l,u,p;switch(i){default:case 0:l=n,u=c,p=o;break;case 1:l=s,u=n,p=o;break;case 2:l=o,u=n,p=c;break;case 3:l=o,u=s,p=n;break;case 4:l=c,u=o,p=n;break;case 5:l=n,u=o,p=s}return{r:Math.floor(255*l),g:Math.floor(255*u),b:Math.floor(255*p)}}static rgbToHsv(t){const e=t.r/255,r=t.g/255,n=t.b/255,i=Math.min(Math.min(e,r),n),a=Math.max(Math.max(e,r),n);let o=0,s=0;if(i!==a){o=60*((e===i?3:r===i?5:1)-(e===i?r-n:r===i?n-e:e-r)/(a-i))%360,s=(a-i)/a}return{h:o,s:s,v:a}}static mixRgb(t,e,r){if(r<=0)return t;if(r>=1)return e;const n=1-r;return{r:n*t.r+r*e.r,g:n*t.g+r*e.g,b:n*t.b+r*e.b}}}const c=s;class l{static toNumber(t){if("number"==typeof t)return Number.isNaN(t)?0:t;const e=Number(t);return Number.isNaN(e)?0:e}static toBoolean(t){return"boolean"==typeof t?t:"string"==typeof t?""!==t&&"0"!==t&&"false"!==t.toLowerCase():Boolean(t)}static toString(t){return String(t)}static toRgbColorList(t){const e=l.toRgbColorObject(t);return[e.r,e.g,e.b]}static toRgbColorObject(t){let e;return"string"==typeof t&&"#"===t.substring(0,1)?(e=c.hexToRgb(t),e||(e={r:0,g:0,b:0,a:255})):e=c.decimalToRgb(l.toNumber(t)),e}static isWhiteSpace(t){return null===t||"string"==typeof t&&0===t.trim().length}static compare(t,e){let r=Number(t),n=Number(e);if(0===r&&l.isWhiteSpace(t)?r=NaN:0===n&&l.isWhiteSpace(e)&&(n=NaN),isNaN(r)||isNaN(n)){const r=String(t).toLowerCase(),n=String(e).toLowerCase();return r<n?-1:r>n?1:0}return r===1/0&&n===1/0||r===-1/0&&n===-1/0?0:r-n}static isInt(t){return"number"==typeof t?!!isNaN(t)||t===parseInt(t,10):"boolean"==typeof t||"string"==typeof t&&t.indexOf(".")<0}static get LIST_INVALID(){return"INVALID"}static get LIST_ALL(){return"ALL"}static toListIndex(t,e,r){if("number"!=typeof t){if("all"===t)return r?l.LIST_ALL:l.LIST_INVALID;if("last"===t)return e>0?e:l.LIST_INVALID;if("random"===t||"any"===t)return e>0?1+Math.floor(Math.random()*e):l.LIST_INVALID}return(t=Math.floor(l.toNumber(t)))<1||t>e?l.LIST_INVALID:t}}var u=l;const p="OPEN_UI_FROM_EXTENSION",_="REGISTER_BUTTON_CALLBACK_FROM_EXTENSION",h="internal_IsCustomArgument",m="dropdownState",g="init",d="open",S="close",T=(t,e)=>t.emit(p,e),y=(t,e,r)=>{t.emit(_,e),t.on(e,r)};var I;!function(t){t.ui="ui";t.text="text";t.motion="motion";t.red="red";t.sound="sound";t.control="control";t.data="data";t.pen="pen";t.error="error";t.extensions="extensions";t.drop="drop"}(I||(I={}));class f{constructor(t){this.root=t}get(...t){return`var(--${this.root}-${t.join("-")})`}primary(...t){return this.get("primary",...t)}secondary(...t){return this.get("secondary",...t)}tertiary(...t){return this.get("tertiary",...t)}transparent(...t){return this.get("transparent",...t)}light(...t){return this.get("light",...t)}}const E=new f(I.ui),b=new f(I.text),O=new f(I.motion),R=new f(I.red),A=new f(I.sound),D=new f(I.control),N=new f(I.data),C=new f(I.pen),L=new f(I.error),w=new f(I.extensions),k=new f(I.extensions),v={ui:{primary:E.primary(),secondary:E.secondary(),tertiary:E.tertiary(),modalOverlay:E.get("modal","overlay"),white:E.get("white"),whiteDim:E.get("white","dim"),whiteTransparent:E.get("white","transparent"),transparent:E.transparent(),blackTransparent:E.get("black","transparent")},text:{primary:b.primary(),primaryTransparent:b.transparent()},motion:{primary:O.primary(),tertiary:O.tertiary(),transparent:O.get("transparent"),lightTansparent:O.light("transparent")},red:{primary:R.primary(),tertiary:R.tertiary()},sound:{primary:A.primary(),tertiary:A.tertiary()},control:{primary:D.primary()},data:{primary:N.primary()},pen:{primary:C.primary(),transparent:C.transparent()},error:{primary:L.primary(),light:L.light(),transparent:L.transparent()},extensions:{primary:w.primary(),tertiary:w.tertiary(),light:w.light(),transparent:w.transparent()},drop:{highlight:k.get("highlight")}};async function x(t,e=100){let r,n=t();for(;!n;)await new Promise((t=>{clearTimeout(r),r=setTimeout(t,e)})),n=t();return clearTimeout(r),n}const P=t=>t=>"string"==typeof t||t instanceof String,B=t=>"[object Function]"===Object.prototype.toString.call(t)||"function"==typeof t||t instanceof Function,M={DrowpdownOpen:d,DropdownClose:S,Init:g},G={selectedBlockID:null,current:-1,update(){return this.current=(new Date).getTime().toString(),this.current}},F=t=>{if(1!==t.length)return!1;const e=t[0];if("object"!=typeof e)return!1;const{text:r}=e;return r===h};function U(t,[e],r){switch(t[m]){case M.Init:return[["Click me","Click me"],["Value of",G.current]];case M.DropdownClose:return[[G.current,G.current]];case M.DrowpdownOpen:return(async t=>{const e="blocklyDropDownContent",r=document.getElementsByClassName(e);if(1!==r.length)return console.error(`Uh oh! Expected 1 element with class '${e}', but found ${r.length}`);const[n]=r,i=await x((()=>n.children[0]));new t({target:n,anchor:i,props:{}})})(r(this.id,e.value)),[["Apply",G.update()]]}throw new Error("Error during processing -- Context:"+M)}function $(t){let e,r=t[0],n=1;for(;n<t.length;){const i=t[n],a=t[n+1];if(n+=2,("optionalAccess"===i||"optionalCall"===i)&&null==r)return;"access"===i||"optionalAccess"===i?(e=r,r=a(r)):"call"!==i&&"optionalCall"!==i||(r=a(((...t)=>r.call(e,...t))),e=void 0)}return r}class j{__init(){this.internal_blocks=[]}__init2(){this.internal_menus=[]}openUI(t,e){const{id:r,name:n,runtime:i}=this;T(i,{id:r,name:n,component:t.replace(".svelte",""),label:e})}constructor(t,e){j.prototype.__init.call(this),j.prototype.__init2.call(this),j.prototype.__init3.call(this),j.prototype.__init4.call(this);const{name:r,id:n,blockIconURI:i}=(o=()=>this[j.InternalCodeGenArgsGetterKey](),null!=(a=e)?a:o());var a,o;this.name=r,this.id=n,this.blockIconURI=i,this.runtime=t,j.ExtensionsByID.set(n,this)}internal_init(){this.init({runtime:this.runtime,videoFeed:$([this,"access",t=>t.runtime,"access",t=>t.ioDevices,"optionalAccess",t=>t.video])});const t=this.defineBlocks(),e=[];for(const r in t){const n=t[r](this),i=this.convertToInfo(r,n,e);this.internal_blocks.push(i)}for(const t of e){let e=!1;if(Array.isArray(t)){const r=t;this.addStaticMenu(r,e)}else if(j.IsFunction(t)){const r=t;this.addDynamicMenu(r,e)}else if(e=!0,"items"in t){const r=t;this.addStaticMenu(r.items,e)}else if("getItems"in t){const r=t;this.addDynamicMenu(r.getItems,e)}else;}}getInfo(){const{id:t,internal_blocks:e,internal_menus:r,name:n,blockIconURI:i}=this,a={id:t,blocks:e,name:n,blockIconURI:i};return r&&(a.menus=Object.entries(this.internal_menus).reduce(((t,[e,r])=>(t[e]=r,t)),{})),a}addStaticMenu(t,e){this.internal_menus.push({acceptReporters:e,items:t.map((t=>t)).map(j.ConvertMenuItemsToString)})}addDynamicMenu(t,e){const r=`internal_dynamic_${this.internal_menus.length}`;this[r]=()=>t().map((t=>t)).map(j.ConvertMenuItemsToString),this.internal_menus.push({acceptReporters:e,items:r})}convertToInfo(t,r,n){const{type:i,text:a,operation:o}=r,s=r.arg?[r.arg]:r.args,c=j.IsFunction(a)?a(...s.map(((t,e)=>`[${e}]`))):a,l=this.format(c,t,`Block text for '${t}'`),u=s?new Array(s.length).fill(void 0):void 0,p=$([s,"optionalAccess",t=>t.map,"call",e=>e(((e,r)=>{const i={};if(i.type=j.GetArgumentType(e),j.IsPrimitive(e))return i;const{defaultValue:a,options:o}=e;if(void 0!==a&&(i.defaultValue=j.IsString(i)?this.format(a,j.GetArgTranslationID(t,r),`Default value for arg ${r+1} of ${t} block`):a),!o)return i;const s=n.indexOf(o),c=s>=0?s:n.push(o)-1;if(i.menu=`${c}`,"handler"in o){const{handler:t}=o;u[r]=t}return i})),"access",t=>t.reduce,"call",t=>t(((t,e,r)=>(t[`${r}`]=e,t)),{})]),_=j.GetInternalKey(t),h=o.bind(this),m=i===e.Button,g=m?j.GetButtonID(this.id,_):void 0;return m?y(this.runtime,g,h):this[_]=(t,e)=>{const r=Object.values(t).slice(0,-1).map(((t,e)=>{const r=u[e]?u[e](t):t,n=j.GetArgumentType(s[e]);return j.CastToType(n,r)}));return h(...r,e)},{opcode:_,text:l,blockType:i,arguments:p,func:g}}__init3(){this.isCustomArgumentHack=F.bind(this)}__init4(){this.processCustomArgumentHack=U.bind(this)}format(t,e,r){return t}static __initStatic(){this.GetExtensionByID=t=>{if(j.ExtensionsByID.has(t))return j.ExtensionsByID.get(t);console.error(`Could not find extension with id '${t}'`)}}static __initStatic2(){this.TryCastToArgumentType=(t,e,r)=>{try{return j.CastToType(t,e)}catch(t){return r(e)}}}static __initStatic3(){this.GetKeyFromOpcode=t=>t.replace(j.GetInternalKey(""),"")}static __initStatic4(){this.GetArgTranslationID=(t,e)=>`${t}-arg${e}-default`}static __initStatic5(){this.GetInternalKey=t=>`internal_${t}`}static __initStatic6(){this.GetButtonID=(t,e)=>`${t}_${e}`}static __initStatic7(){this.GetArgumentType=t=>j.IsPrimitive(t)?t:t.type}static __initStatic8(){this.ToFlag=t=>1===parseInt(t)}static __initStatic9(){this.ToMatrix=t=>{if(25!==t.length)return new Array(5).fill(new Array(5).fill(!1));return t.split("").map(j.ToFlag).reduce(((t,e,r)=>{const n=Math.floor(r/5);return 0===r%5?t[n]=[e]:t[n].push(e),t}),new Array(5))}}static __initStatic10(){this.CastToType=(t,e)=>{switch(t){case r.String:return`${e}`;case r.Number:return parseFloat(e);case r.Boolean:return JSON.parse(e);case r.Note:case r.Angle:return parseInt(e);case r.Matrix:return j.ToMatrix(e);case r.Color:return u.toRgbColorObject(e);default:throw new Error(`Method not implemented for value of ${e} and type ${t}`)}}}static __initStatic11(){this.ConvertMenuItemsToString=t=>j.IsPrimitive(t)?`${t}`:{...t,value:`${t.value}`}}static __initStatic12(){this.IsPrimitive=t=>t!==Object(t)}static __initStatic13(){this.IsFunction=t=>B(t)}static __initStatic14(){this.IsString=t=>P()}static __initStatic15(){this.ExtensionsByID=new Map}static __initStatic16(){this.InternalCodeGenArgsGetterKey="internal_getCodeGenArgs"}static __initStatic17(){this.TestGetInfo=(t,...e)=>t.getInfo(...e)}static __initStatic18(){this.TestGetBlocks=(t,...e)=>t.getInfo(...e).blocks}static __initStatic19(){this.TestInit=(t,...e)=>t.internal_init(...e)}}var H;j.__initStatic(),j.__initStatic2(),j.__initStatic3(),j.__initStatic4(),j.__initStatic5(),j.__initStatic6(),j.__initStatic7(),j.__initStatic8(),j.__initStatic9(),j.__initStatic10(),j.__initStatic11(),j.__initStatic12(),j.__initStatic13(),j.__initStatic14(),j.__initStatic15(),j.__initStatic16(),j.__initStatic17(),j.__initStatic18(),j.__initStatic19(),function(t){t.Arg="arg";t.Args="args"}(H||(H={}));const K=new RegExp("^[a-z0-9]+$","i"),V=new RegExp("[^a-z0-9]+","gi"),z=["prg","prg".split("").reverse().join("")],W=new RegExp(`${z[0]}([0-9]+)${z[1]}`,"g"),J=(t,e,r)=>t.replaceAll(e,r);return t.ArgumentType=r,t.BlockType=e,t.Branch={Exit:0,Enter:1,First:1,Second:2,Third:3,Fourth:4,Fifth:5,Sixth:6,Seventh:7},t.Extension=j,t.FrameworkID="ExtensionFramework",t.Language=a,t.LanguageKeys=o,t.LayerGroups=i,t.RuntimeEvent={ScriptGlowOn:"SCRIPT_GLOW_ON",ScriptGlowOff:"SCRIPT_GLOW_OFF",BlockGlowOn:"BLOCK_GLOW_ON",BlockGlowOff:"BLOCK_GLOW_OFF",HasCloudDataUpdate:"HAS_CLOUD_DATA_UPDATE",TurboModeOn:"TURBO_MODE_ON",TurboModeOff:"TURBO_MODE_OFF",RecordingOn:"RECORDING_ON",RecordingOff:"RECORDING_OFF",ProjectStart:"PROJECT_START",ProjectRunStart:"PROJECT_RUN_START",ProjectRunStop:"PROJECT_RUN_STOP",ProjectStopAll:"PROJECT_STOP_ALL",StopForTarget:"STOP_FOR_TARGET",VisualReport:"VISUAL_REPORT",ProjectLoaded:"PROJECT_LOADED",ProjectChanged:"PROJECT_CHANGED",ToolboxExtensionsNeedUpdate:"TOOLBOX_EXTENSIONS_NEED_UPDATE",TargetsUpdate:"TARGETS_UPDATE",MonitorsUpdate:"MONITORS_UPDATE",BlockDragUpdate:"BLOCK_DRAG_UPDATE",BlockDragEnd:"BLOCK_DRAG_END",ExtensionAdded:"EXTENSION_ADDED",ExtensionFieldAdded:"EXTENSION_FIELD_ADDED",PeripheralListUpdate:"PERIPHERAL_LIST_UPDATE",PeripheralConnected:"PERIPHERAL_CONNECTED",PeripheralDisconnected:"PERIPHERAL_DISCONNECTED",PeripheralRequestError:"PERIPHERAL_REQUEST_ERROR",PeripheralConnectionLostError:"PERIPHERAL_CONNECTION_LOST_ERROR",PeripheralScanTimeout:"PERIPHERAL_SCAN_TIMEOUT",MicListening:"MIC_LISTENING",BlocksInfoUpdate:"BLOCKSINFO_UPDATE",RuntimeStarted:"RUNTIME_STARTED",RuntimeDisposed:"RUNTIME_DISPOSED",BlocksNeedUpdate:"BLOCKS_NEED_UPDATE"},t.ScratchBlocksConstants={OutputShapeHexagonal:1,OutputShapeRound:2,OutputShapeSquare:3},t.StageLayering=n,t.TargetType={Sprite:"sprite",Stage:"stage"},t.VariableType={Scalar:"",List:"list",BrooadcastMessage:"broadcast_msg"},t.activeClass=!0,t.closeDropdownState=S,t.color=v,t.customArgumentFlag=h,t.decode=t=>[...[...t.matchAll(W)].reduce(((t,e)=>{const[r,n]=e;return t.set(r,String.fromCharCode(n))}),new Map)].reduce(((t,[e,r])=>J(t,e,r)),`${t}`),t.dropdownStateFlag=m,t.encode=t=>[...[...t.matchAll(V)].reduce(((t,e)=>(e[0].split("").forEach((e=>t.add(e))),t)),new Set)].map((t=>({char:t,code:t.charCodeAt(0)}))).reduce(((t,{char:e,code:r})=>J(t,e,`${z[0]}${r}${z[1]}`)),`${t}`),t.fetchWithTimeout=async function(t,e){const{timeout:r}=e,n=new AbortController,i=setTimeout((()=>n.abort()),r),a=await fetch(t,{...e,signal:n.signal});return clearTimeout(i),a},t.getTextFromMenuItem=t=>"object"==typeof t?t.text:t,t.getValueFromMenuItem=t=>"object"==typeof t?t.value:t,t.initDropdownState=g,t.isFunction=B,t.isString=P,t.isValidID=t=>K.test(t),t.openDropdownState=d,t.openUI=T,t.openUIEvent=p,t.px=t=>`${t}px`,t.reactiveInvoke=(t,e,r)=>t[e](...r),t.reactiveSet=(t,e,r)=>{t[e]=r},t.registerButtonCallback=y,t.registerButtonCallbackEvent=_,t.splitOnCapitals=t=>t.split(/(?=[A-Z])/),t.waitForCondition=async function(t,e=100){let r;for(;!t();)await new Promise((t=>{clearTimeout(r),r=setTimeout(t,e)}));clearTimeout(r)},t.waitForObject=x,Object.defineProperty(t,"__esModule",{value:!0}),t}({});//# sourceMappingURL=ExtensionFramework.js.map
