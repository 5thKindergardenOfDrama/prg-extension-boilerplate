{"version":3,"file":"doodlebot.js","sources":["../../../../extensions/scripts/node_modules/tslib/tslib.es6.js","../../../../extensions/src/doodlebot/enums.ts","../../../../extensions/src/doodlebot/communication/EventDispatcher.ts","../../../../extensions/src/doodlebot/communication/PromiseQueue.ts","../../../../extensions/src/doodlebot/communication/ServiceHelper.ts","../../../../extensions/src/doodlebot/communication/UartService.ts","../../../../extensions/src/doodlebot/Doodlebot.ts","../../../../extensions/src/doodlebot/index.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    function next() {\r\n        while (env.stack.length) {\r\n            var rec = env.stack.pop();\r\n            try {\r\n                var result = rec.dispose && rec.dispose.call(rec.value);\r\n                if (rec.async) return Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n};\r\n","const anim = {\n    angry: \"a\",\n    annoyed: \"y\",\n    confused: \"m\",\n    disgust: \"d\",\n    engaged: \"e\",\n    fear: \"f\",\n    happy: \"h\",\n    love: \"o\",\n    neutral: \"n\",\n    sad: \"s\",\n    sleeping: \"l\",\n    surprise: \"p\",\n    wink: \"i\",\n    worried: \"r\",\n    wrong: \"w\",\n} as const;\n\nexport type Anim = keyof typeof anim;\n\nexport const anims = Object.keys(anim) as Anim[];\n\nexport const command = {\n    enable: \"e\",\n    disable: \"x\",\n    motor: \"m\",\n    arc: \"t\",\n    wifi: \"k\",\n    lowPower: \"q\",\n    display: \"w\"\n} as const;\n\nexport type CommandKey = keyof typeof command;\nexport type Command = typeof command[CommandKey];\n\nexport const sensor = {\n    battery: \"f\",\n    bumper: \"b\",\n    humidity: \"h\",\n    pressure: \"p\",\n    distance: \"d\",\n    altimeter: \"u\",\n    magnometer: \"o\",\n    temperature: \"t\",\n    accelerometer: \"a\",\n    gyroscope: \"g\",\n    light: \"l\",\n} as const;\n\nexport type SensorKey = keyof typeof sensor;\nexport type Sensor = typeof sensor[SensorKey];\nexport type SensorKeyByValue = { [K in SensorKey as typeof sensor[K]]: K };\n\nexport const keyBySensor = Object.fromEntries(Object.entries(sensor).map(([key, value]) => [value, key])) as SensorKeyByValue;\n\nexport const motorCommandReceived = \"ms\";\n\nexport const networkStatus = {\n    ipPrefix: \"RPI ipaddr:\",\n    hostnamePrefix: \"hname:\",\n} as const;\n\nexport type NetworkStatusKey = keyof typeof networkStatus;\nexport type NetworkStatus = typeof networkStatus[NetworkStatusKey];\n\nexport type ReceivedCommand = Sensor | typeof motorCommandReceived;\n\nexport const port = {\n    websocket: \"8765\",\n    camera: \"8000\"\n}\n\nconst endpoint = {\n    camera: \"video_feed'\"\n}","/*\n * micro:bit Web Bluetooth\n * Copyright (c) 2019 Rob Moran\n *\n * The MIT License (MIT)\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport EventEmitter from \"events\";\n\nexport default class EventDispatcher<T extends Record<string, any> = Record<string, unknown>> extends EventEmitter {\n    isEventListenerObject(listener): listener is EventListenerObject {\n        return listener.handleEvent !== undefined;\n    }\n\n    addEventListener<K extends keyof T & string>(type: K, listener: (event: CustomEvent<T[K]>) => void): void {\n        if (listener) {\n            const handler = this.isEventListenerObject(listener)\n                ? listener.handleEvent\n                : listener;\n            super.addListener(type, handler);\n        }\n    }\n\n    removeEventListener<K extends keyof T & string>(type: K, callback: (event: CustomEvent<T[K]>) => void): void {\n        if (callback) {\n            const handler = this.isEventListenerObject(callback)\n                ? callback.handleEvent\n                : callback;\n            super.removeListener(type, handler);\n        }\n    }\n\n    dispatchEvent<K extends keyof T | CustomEvent<T[keyof T]>>(eventOrType: K, detail: K extends string ? T[K] : K): boolean {\n        const event = typeof eventOrType === \"string\"\n            ? new CustomEvent(eventOrType, { detail, })\n            : eventOrType as CustomEvent;\n        return super.emit(event.type, event);\n    }\n}","/*\n * micro:bit Web Bluetooth\n * Copyright (c) 2019 Rob Moran\n *\n * The MIT License (MIT)\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\ntype QueuedPromise = {\n    fn: () => Promise<any>;\n    resolve: (value?: any | PromiseLike<any> | undefined) => void;\n    reject: (reason?: any) => void;\n}\n\nexport default class PromiseQueue {\n    private queue: QueuedPromise[] = [];\n    private running: number = 0;\n\n    constructor(private concurrent = 1) { }\n\n    async pump() {\n        if (this.running >= this.concurrent) return;\n\n        const promise = this.queue.shift();\n\n        if (!promise) return;\n\n        this.running++;\n\n        try {\n            const result = await promise.fn();\n            promise.resolve(result);\n        } catch (error) {\n            promise.reject(error);\n        }\n\n        this.running--;\n\n        return this.pump();\n    }\n\n    add(fn: QueuedPromise[\"fn\"]) {\n        return new Promise((resolve, reject) => {\n            this.queue.push({\n                fn,\n                resolve,\n                reject,\n            });\n\n            return this.pump();\n        });\n    }\n}","/*\n * micro:bit Web Bluetooth\n * Copyright (c) 2019 Rob Moran\n *\n * The MIT License (MIT)\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n/// <reference types=\"@types/web-bluetooth\" />\n\nimport type EventEmitter from \"events\";\nimport PromiseQueue from \"./PromiseQueue\";\n\nexport interface Service {\n    uuid: BluetoothCharacteristicUUID;\n    create(service: BluetoothRemoteGATTService): Promise<any>;\n}\n\nexport default class ServiceHelper {\n    private queue = new PromiseQueue();\n    private characteristics: BluetoothRemoteGATTCharacteristic[];\n\n    constructor(private service: BluetoothRemoteGATTService, private emitter: EventEmitter) { }\n\n    async getCharacteristic(uuid: string) {\n        this.characteristics ??= await this.service.getCharacteristics();\n        return this.characteristics.find((characteristic) => characteristic.uuid === uuid);\n    }\n\n    async getCharacteristicValue(uuid: string) {\n        const characteristic = await this.getCharacteristic(uuid);\n        if (!characteristic) throw new Error(\"Unable to locate characteristic\");\n        return await this.queue.add(async () => characteristic.readValue());\n    }\n\n    async setCharacteristicValue(uuid, value) {\n        const characteristic = await this.getCharacteristic(uuid);\n        if (!characteristic) throw new Error(\"Unable to locate characteristic\");\n        await this.queue.add(async () => characteristic.writeValueWithoutResponse(value));\n    }\n\n    async handleListener(event, uuid, handler) {\n        const characteristic = await this.getCharacteristic(uuid);\n\n        if (!characteristic) return;\n\n        await this.queue.add(async () => characteristic.startNotifications());\n\n        this.emitter.on(\"newListener\", (emitterEvent) => {\n            if (emitterEvent !== event || this.emitter.listenerCount(event) > 0) return;\n            return this.queue.add(async () =>\n                characteristic.addEventListener(\"characteristicvaluechanged\", handler)\n            );\n        });\n\n        this.emitter.on(\"removeListener\", (emitterEvent) => {\n            if (emitterEvent !== event || this.emitter.listenerCount(event) > 0) return;\n            return this.queue.add(async () =>\n                characteristic.removeEventListener(\"characteristicvaluechanged\", handler)\n            );\n        });\n    }\n}","/*\n * micro:bit Web Bluetooth\n * Copyright (c) 2019 Rob Moran\n *\n * The MIT License (MIT)\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\nimport EventDispatcher from \"./EventDispatcher\";\nimport ServiceHelper, { Service } from \"./ServiceHelper\";\n\n/**\n * Events raised by the UART service\n * newListener: keyof UartEvents;\n * removeListener: keyof UartEvents;\n * receive: Uint8Array;\n * receiveText: string;\n */\n\n/**\n * Events raised by the UART service\n */\nexport interface UartEvents {\n    /**\n     * @hidden\n     */\n    newListener: keyof UartEvents;\n    /**\n     * @hidden\n     */\n    removeListener: keyof UartEvents;\n    /**\n     * Serial data received event\n     */\n    receive: Uint8Array;\n    /**\n     * Serial received text event\n     */\n    receiveText: string;\n}\n\nexport default class UartService extends EventDispatcher<UartEvents> {\n    static readonly uuid = \"6e400001-b5a3-f393-e0a9-e50e24dcca9e\";\n\n    static readonly rx_uuid = \"6e400002-b5a3-f393-e0a9-e50e24dcca9e\";\n\n    static readonly tx_uuid = \"6e400003-b5a3-f393-e0a9-e50e24dcca9e\";\n\n    static async create(service) {\n        const bluetoothService = new UartService(service);\n        await bluetoothService.init();\n        return bluetoothService;\n    }\n\n    private helper: ServiceHelper;\n\n    constructor(service) {\n        super();\n        this.helper = new ServiceHelper(service, this);\n    }\n\n    async init() {\n        const { tx_uuid } = UartService;\n        await this.helper.handleListener(\"receive\", tx_uuid, this.receiveHandler.bind(this));\n        await this.helper.handleListener(\"receiveText\", tx_uuid, this.receiveTextHandler.bind(this));\n    }\n\n    /**\n     * Send serial data\n     * @param value The buffer to send\n     */\n    async send(value) {\n        return this.helper.setCharacteristicValue(UartService.rx_uuid, value);\n    }\n\n    /**\n     * Send serial text\n     * @param value The text to send\n     */\n    async sendText(value) {\n        const arrayData = value.split(\"\").map((e) => e.charCodeAt(0));\n        return this.helper.setCharacteristicValue(\n            UartService.rx_uuid,\n            new Uint8Array(arrayData).buffer\n        );\n    }\n\n    receiveHandler(event) {\n        const view = event.target.value;\n        const value = new Uint8Array(view.buffer);\n        this.dispatchEvent(\"receive\", value);\n    }\n\n    receiveTextHandler(event) {\n        const view = event.target.value;\n        const numberArray = new Uint8Array(view.buffer).slice()\n        const value = String.fromCharCode.apply(null, numberArray);\n        this.dispatchEvent(\"receiveText\", value);\n    }\n}","import EventEmitter from \"events\";\nimport { Service } from \"./communication/ServiceHelper\";\nimport UartService from \"./communication/UartService\";\nimport { Command, NetworkStatus, ReceivedCommand, SensorKey, command, keyBySensor, motorCommandReceived, networkStatus, port, sensor } from \"./enums\";\n\nexport type Services = Awaited<ReturnType<typeof Doodlebot.getServices>>;\nexport type MotorStepRequest = { steps: number, stepsPerSecond: number };\nexport type Bumper = { front: number, back: number };\nexport type Vector3D = { x: number, y: number, z: number };\nexport type Color = { red: number, green: number, blue: number, alpha: number };\nexport type SensorReading = number | Vector3D | Bumper | Color;\nexport type SensorData = Doodlebot[\"sensorData\"];\nexport type NetworkCredentials = { ssid: string, password: string };\nexport type NetworkConnection = { ip: string, hostname: string };\n\ntype Pending = Record<\"motor\" | \"wifi\" | \"websocket\", Promise<any> | undefined>;\n\ntype SubscriptionTarget = Pick<EventTarget, \"addEventListener\" | \"removeEventListener\">;\n\ntype Subscription<T extends SubscriptionTarget> = {\n    target: T,\n    event: Parameters<T[\"addEventListener\"]>[0],\n    listener: Parameters<T[\"addEventListener\"]>[1],\n}\n\ntype MotorCommand = \"steps\" | \"arc\" | \"stop\";\ntype DisplayCommand = \"clear\";\n\nconst trimNewtworkStatusMessage = (message: string, prefix: NetworkStatus) => message.replace(prefix, \"\").trim();\n\nconst localIp = \"127.0.0.1\";\n\nconst events = {\n    stop: \"motor\",\n    connect: \"connect\",\n    disconnect: \"disconnect\",\n} as const;\n\nexport default class Doodlebot {\n    /**\n     * \n     * @param services \n     * @param serviceClass \n     * @returns \n     */\n    static async tryCreateService<T extends Service & (new (...args: any) => any)>(\n        services: BluetoothRemoteGATTService[], serviceClass: T\n    ): Promise<InstanceType<T>> {\n        const found = services.find((service) => service.uuid === serviceClass.uuid);\n        return found ? await serviceClass.create(found) : undefined;\n    }\n\n    /**\n     * \n     * @param bluetooth \n     * @param devicePrefix @todo unused\n     * @returns \n     */\n    static async requestRobot(bluetooth: Bluetooth, ...filters: BluetoothLEScanFilter[]) {\n        const device = await bluetooth.requestDevice({\n            filters: [\n                ...(filters ?? []),\n                {\n                    services: [UartService.uuid]\n                },\n            ],\n        });\n\n        return device;\n    }\n\n    /**\n     * Get\n     * @param device \n     * @returns \n     */\n    static async getServices(device: BluetoothDevice) {\n        if (!device || !device.gatt) return null;\n        if (!device.gatt.connected) await device.gatt.connect();\n\n        const services = await device.gatt.getPrimaryServices();\n        const uartService = await Doodlebot.tryCreateService(services, UartService);\n\n        return { uartService, };\n    }\n\n    /**\n     * \n     * @param ble \n     * @param filters \n     * @throws \n     * @returns \n     */\n    static async tryCreate(ssid: string, password: string, ble: Bluetooth, ...filters: BluetoothLEScanFilter[]) {\n        const robot = await Doodlebot.requestRobot(ble, ...filters);\n        const services = await Doodlebot.getServices(robot);\n        if (!services) throw new Error(\"Unable to connect to doodlebot's UART service\");\n        return new Doodlebot(robot, services, ssid, password);\n    }\n\n    private pending: Pending = { motor: undefined, wifi: undefined, websocket: undefined };\n    private onMotor = new EventEmitter();\n    private onSensor = new EventEmitter();\n    private onNetwork = new EventEmitter();\n    private disconnectCallbacks = new Set<() => void>();\n    private subscriptions = new Array<Subscription<any>>();\n    private connection: NetworkConnection;\n    private websocket: WebSocket;\n\n    private sensorData = ({\n        bumper: { front: 0, back: 0 },\n        altimeter: 0,\n        battery: 0,\n        distance: 0,\n        humidity: 0,\n        temperature: 0,\n        pressure: 0,\n        gyroscope: { x: 0, y: 0, z: 0 },\n        magnometer: { x: 0, y: 0, z: 0 },\n        accelerometer: { x: 0, y: 0, z: 0 },\n        light: { red: 0, green: 0, blue: 0, alpha: 0 }\n    } satisfies Record<SensorKey, SensorReading>);\n\n    private sensorState: Record<SensorKey, boolean> = {\n        bumper: false,\n        altimeter: false,\n        battery: false,\n        distance: false,\n        humidity: false,\n        temperature: false,\n        pressure: false,\n        gyroscope: false,\n        magnometer: false,\n        accelerometer: false,\n        light: false\n    };\n\n    constructor(private device: BluetoothDevice, private services: Services, private ssid: string, private wifiPassword: string) {\n        this.subscribe(services.uartService, \"receiveText\", this.receiveTextBLE.bind(this));\n        this.subscribe(device, \"gattserverdisconnected\", this.handleBleDisconnect.bind(this));\n        this.connectToWebsocket({ ssid, password: wifiPassword });\n    }\n\n    private subscribe<T extends SubscriptionTarget>(target: T, event: Subscription<T>[\"event\"], listener: Subscription<T>[\"listener\"]) {\n        target.addEventListener(event, listener);\n        this.subscriptions.push({ target, event, listener });\n    }\n\n    private formCommand(...args: (string | number)[]) {\n        return `(${args.join(\",\")})`;\n    }\n\n    private parseCommand(command: string) {\n        const lines = command.split(\"(\").map((line) => line.replace(\")\", \"\"));\n        return lines.map((line) => {\n            const [command, ...parameters] = line.split(\",\") as [ReceivedCommand, ...string[]];\n            return { command, parameters };\n        });\n    }\n\n    private sendBLECommand(command: Command, ...args: (string | number)[]) {\n        const { uartService } = this.services;\n        return uartService.sendText(this.formCommand(command, ...args));\n    }\n\n    private async sendWebsocketCommand(command: Command, ...args: (string | number)[]) {\n        await this.connectToWebsocket();\n        this.websocket.send(this.formCommand(command, ...args));\n    }\n\n    private updateSensor<T extends SensorKey>(type: T, value: SensorData[T]) {\n        this.onSensor.emit(type, value);\n        this.sensorData[type] = value;\n    }\n\n    private updateNetworkStatus(ipComponent: string, hostnameComponent: string) {\n        const ip = trimNewtworkStatusMessage(ipComponent, networkStatus.ipPrefix);\n        const hostname = trimNewtworkStatusMessage(hostnameComponent, networkStatus.hostnamePrefix);\n        if (ip === localIp) return this.onNetwork.emit(events.disconnect);\n        this.connection = { ip, hostname };\n        this.onNetwork.emit(events.connect, this.connection);\n    }\n\n    private receiveTextBLE(event: CustomEvent<string>) {\n        for (const { command, parameters } of this.parseCommand(event.detail)) {\n            if (command.startsWith(networkStatus.ipPrefix)) {\n                this.updateNetworkStatus(command, parameters[0]);\n                continue;\n            }\n            switch (command) {\n                case motorCommandReceived:\n                    this.onMotor.emit(events.stop);\n                    break;\n                case sensor.bumper: {\n                    const [front, back] = parameters.map((parameter) => Number.parseFloat(parameter));\n                    this.updateSensor(keyBySensor[command], { front, back });\n                    break;\n                }\n                case sensor.distance:\n                case sensor.battery:\n                case sensor.altimeter:\n                case sensor.humidity:\n                case sensor.temperature:\n                case sensor.pressure: {\n                    const value = Number.parseFloat(parameters[0]);\n                    this.updateSensor(keyBySensor[command], value);\n                    break;\n                }\n                case sensor.gyroscope:\n                case sensor.magnometer:\n                case sensor.accelerometer: {\n                    const [x, y, z] = parameters.map((parameter) => Number.parseFloat(parameter));\n                    this.updateSensor(keyBySensor[command], { x, y, z });\n                    break;\n                }\n                case sensor.light: {\n                    const [red, green, blue, alpha] = parameters.map((parameter) => Number.parseFloat(parameter));\n                    this.updateSensor(keyBySensor[command], { red, green, blue, alpha });\n                    break;\n                }\n                default:\n                    throw new Error(`Not implemented: ${command}`);\n            }\n        }\n    }\n\n    private onWebsocketMessage(event: MessageEvent) {\n    }\n\n    private invalidateWifiConnection() {\n        this.connection = undefined;\n        this.pending.wifi = undefined;\n        this.pending.websocket = undefined;\n        this.websocket?.close();\n        this.websocket = undefined;\n    }\n\n    private handleBleDisconnect() {\n        for (const callback of this.disconnectCallbacks) callback();\n        for (const { target, event, listener } of this.subscriptions) target.removeEventListener(event, listener);\n    }\n\n    onDisconnect(...callbacks: (() => void)[]) {\n        for (const callback of callbacks) this.disconnectCallbacks.add(callback);\n    }\n\n    /**\n     * \n     * @param type \n     * @returns \n     */\n    async enableSensor<T extends SensorKey>(type: T) {\n        if (this.sensorState[type]) return;\n        await this.sendBLECommand(command.enable, sensor[type]);\n        await new Promise((resolve) => this.onSensor.once(type, resolve));\n        this.sensorState[type] = true;\n    }\n\n    /**\n     * \n     */\n    async disableSensor<T extends SensorKey>(type: T) {\n        if (!this.sensorState[type]) return;\n        await this.sendBLECommand(command.disable, sensor[type]);\n        this.sensorState[type] = false;\n    }\n\n    /**\n     * \n     * @param type \n     * @returns \n     */\n    async getSensorReading<T extends SensorKey>(type: T): Promise<SensorData[T]> {\n        await this.enableSensor(type);\n        return this.sensorData[type];\n    }\n\n    /**\n     * \n     * @param type \n     * @param left \n     * @param rightSteps \n     */\n    async motorCommand(type: \"steps\", left: MotorStepRequest, rightSteps: MotorStepRequest);\n    /**\n     * \n     * @param type \n     * @param radius \n     * @param degrees \n     */\n    async motorCommand(type: \"arc\", radius: number, degrees: number);\n    /**\n     * \n     * @param type \n     */\n    async motorCommand(type: \"stop\");\n    async motorCommand(type: string, ...args: any[]) {\n        const { pending: { motor: pending } } = this;\n        switch (type) {\n            case \"steps\": {\n                if (pending) await pending;\n                const [left, right] = args as MotorStepRequest[];\n                return await this.untilFinishedPending(\"motor\", new Promise(async (resolve) => {\n                    await this.sendBLECommand(command.motor, left.steps, right.steps, left.stepsPerSecond, right.stepsPerSecond);\n                    this.onMotor.once(events.stop, resolve);\n                }));\n            }\n            case \"arc\": {\n                if (pending) await pending;\n                const [radius, degrees] = args as number[];\n                return await this.untilFinishedPending(\"motor\", new Promise(async (resolve) => {\n                    await this.sendBLECommand(command.motor, radius, degrees);\n                    this.onMotor.once(events.stop, resolve);\n                }));\n            }\n            case \"stop\":\n                return await this.untilFinishedPending(\"motor\", new Promise(async (resolve) => {\n                    await this.sendBLECommand(command.motor, \"s\");\n                    this.onMotor.once(events.stop, resolve);\n                }));\n        }\n    }\n\n    /**\n     * \n     */\n    async lowPowerMode() {\n        await this.sendBLECommand(command.lowPower);\n    }\n\n    /**\n     * \n     * @param ssid \n     * @param password \n     */\n    async connectToWifi(credentials?: NetworkCredentials) {\n        const { ssid, pending: { wifi: pending } } = this;\n        const invalidate = credentials && credentials.ssid !== ssid;\n        if (invalidate) {\n            this.invalidateWifiConnection();\n            this.ssid = credentials.ssid;\n            this.wifiPassword = credentials.password;\n        }\n        else if (pending) await pending;\n\n        if (this.connection) return;\n\n        await this.untilFinishedPending(\"wifi\", new Promise(async (resolve) => {\n            await this.sendBLECommand(command.wifi, this.ssid, this.wifiPassword);\n            this.onNetwork.once(events.connect, resolve)\n        }));\n    }\n\n    async untilFinishedPending(type: keyof Pending, promise: Promise<any>) {\n        this.pending[type] = promise;\n        await promise;\n        this.pending[type] = undefined;\n    }\n\n    /**\n     * \n     * @param credentials \n     */\n    async connectToWebsocket(credentials?: NetworkCredentials) {\n        await this.connectToWifi(credentials);\n        const { pending: { websocket: pending } } = this;\n        if (pending) await pending;\n        if (this.websocket) return;\n        this.websocket = new WebSocket(`ws://${this.connection.ip}:${port.websocket}`);\n        await this.untilFinishedPending(\"websocket\", new Promise<void>((resolve) => {\n            const resolveAndRemove = () => {\n                this.websocket.removeEventListener(\"open\", resolveAndRemove);\n                resolve();\n            }\n            this.websocket.addEventListener(\"open\", resolveAndRemove);\n            this.websocket.addEventListener(\"message\", this.onWebsocketMessage.bind(this));\n        }));\n    }\n\n    async display(type: \"clear\");\n    async display(type: DisplayCommand) {\n        switch (type) {\n            case \"clear\":\n                await this.sendWebsocketCommand(command.display, \"c\");\n                break;\n        }\n    }\n}","import { Environment, ExtensionMenuDisplayDetails, extension, block, buttonBlock } from \"$common\";\nimport { Anim, anims } from \"./enums\";\nimport Doodlebot from \"./Doodlebot\";\n\nconst details: ExtensionMenuDisplayDetails = {\n  name: \"Doodlebot\",\n  description: \"Program a doodlebot robot\",\n  iconURL: \"Replace with the name of your icon image file (which should be placed in the same directory as this file)\",\n  insetIconURL: \"Replace with the name of your inset icon image file (which should be placed in the same directory as this file)\"\n};\n\nexport default class DoodlebotBlocks extends extension(details, \"indicators\") {\n\n  private doodlebot: Doodlebot;\n\n  init(env: Environment) {\n  }\n\n  async connectToBLE() {\n    console.log(\"Getting BLE device\");\n    const { bluetooth } = window.navigator;\n    if (!bluetooth) return alert(\"Your browser does not allow / support bluetooth.\");\n    try {\n      const namePrefix = \"Bluefruit52\"; /* \"Saira\" \"BBC micro:bit\"; TODO: might delete? */\n      this.doodlebot = await Doodlebot.tryCreate(\"\", \"\", bluetooth, { namePrefix });\n      await this.indicateFor({ position: \"category\", msg: \"Connected to robot\" }, 1000);\n    } catch (err) { DoodlebotBlocks.ProcessConnectionError(err); }\n  }\n\n  @buttonBlock(\"Test Robot\")\n  test() {\n\n  }\n\n  @buttonBlock(\"Connect Robot\")\n  connect() {\n    this.connectToBLE();\n  }\n\n  @block({\n    type: \"command\",\n    text: (anim) => `play ${anim} animation`,\n    arg: {\n      type: \"string\",\n      options: anims,\n      defaultValue: \"happy\"\n    }\n  })\n  playAnimation(anim: Anim) {\n\n  }\n\n  @block({\n    type: \"command\",\n    text: (text) => `display text ${text}`,\n    arg: {\n      type: \"string\",\n      defaultValue: \"Hello!\"\n    }\n  })\n  displayText(text: string) {\n\n  }\n\n  @block({\n    type: \"command\",\n    text: \"clear display\"\n  })\n  clearDisplay() {\n\n  }\n\n  private static ProcessConnectionError(err: Error) {\n    console.error(err);\n    if (err.message == \"Bluetooth adapter not available.\")\n      alert(\"Your device does not support BLE connections.\");\n    if (err.message == \"User cancelled the requestDevice() chooser.\")\n      alert(\"You must select a device to connect to. Please try again.\");\n    else if (err.message !== \"User cancelled the requestDevice() chooser.\")\n      alert(\"There was a problem connecting your device, please try again or request assistance.\");\n  }\n}"],"names":["doodlebot","exports","$common","__esDecorate","ctor","descriptorIn","decorators","contextIn","initializers","extraInitializers","accept","f","TypeError","_","kind","key","target","prototype","descriptor","Object","getOwnPropertyDescriptor","name","done","i","length","context","p","access","addInitializer","push","result","get","set","init","unshift","defineProperty","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","then","apply","SuppressedError","anims","keys","angry","annoyed","confused","disgust","engaged","fear","happy","love","neutral","sad","sleeping","surprise","wink","worried","wrong","command","sensor","battery","bumper","humidity","pressure","distance","altimeter","magnometer","temperature","accelerometer","gyroscope","light","keyBySensor","fromEntries","entries","map","networkStatus","port","domain","EventDispatcher","EventEmitter","isEventListenerObject","listener","undefined","handleEvent","addEventListener","type","handler","this","super","addListener","removeEventListener","callback","removeListener","dispatchEvent","eventOrType","detail","event","CustomEvent","emit","PromiseQueue","constructor","concurrent","queue","running","pump","promise","shift","fn","error","add","ServiceHelper","service","emitter","getCharacteristic","uuid","_a","characteristics","getCharacteristics","find","characteristic","getCharacteristicValue","Error","readValue","setCharacteristicValue","writeValueWithoutResponse","handleListener","startNotifications","on","emitterEvent","listenerCount","UartService","create","bluetoothService","helper","tx_uuid","receiveHandler","bind","receiveTextHandler","send","rx_uuid","sendText","arrayData","split","charCodeAt","Uint8Array","buffer","view","numberArray","slice","String","fromCharCode","trimNewtworkStatusMessage","message","prefix","replace","trim","events","Doodlebot","tryCreateService","services","serviceClass","found","requestRobot","bluetooth","filters","requestDevice","getServices","device","gatt","connected","connect","getPrimaryServices","uartService","tryCreate","ssid","password","ble","robot","wifiPassword","pending","motor","wifi","websocket","onMotor","onSensor","onNetwork","disconnectCallbacks","Set","subscriptions","Array","sensorData","front","back","x","y","z","red","green","blue","alpha","sensorState","subscribe","receiveTextBLE","handleBleDisconnect","connectToWebsocket","formCommand","args","join","parseCommand","line","parameters","sendBLECommand","sendWebsocketCommand","updateSensor","updateNetworkStatus","ipComponent","hostnameComponent","ip","hostname","connection","startsWith","parameter","Number","parseFloat","onWebsocketMessage","invalidateWifiConnection","close","onDisconnect","callbacks","enableSensor","once","disableSensor","getSensorReading","motorCommand","left","right","untilFinishedPending","steps","stepsPerSecond","radius","degrees","lowPowerMode","connectToWifi","credentials","WebSocket","resolveAndRemove","display","details","description","iconURL","insetIconURL","_classSuper","extension","useValue","arguments","call","__runInitializers","_instanceExtraInitializers","env","connectToBLE","console","log","window","navigator","alert","namePrefix","indicateFor","position","msg","err","ProcessConnectionError","test","playAnimation","anim","displayText","text","clearDisplay","buttonBlock","_playAnimation_decorators","block","arg","options","defaultValue","_displayText_decorators","_clearDisplay_decorators","_test_decorators","static","private","has","obj","metadata","_metadata","_connect_decorators"],"mappings":"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"}