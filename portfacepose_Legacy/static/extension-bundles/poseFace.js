var poseFace=function(e,t){"use strict";const i={id:"poseFace",name:"Face Sensing",showStatusButton:!0,blocks:[{opcode:"affdexGoToPart",text:"go to [AFFDEX_POINT]",blockType:"command",isTerminal:!1,arguments:{AFFDEX_POINT:{type:"string",defaultValue:"0",menu:"AFFDEX_POINT"}}},{opcode:"affdexWhenExpression",text:"when [EXPRESSION] detected",blockType:"hat",isTerminal:!0,arguments:{EXPRESSION:{type:"string",defaultValue:"smile",menu:"EXPRESSION"}}},{opcode:"affdexExpressionAmount",text:"amount of [EXPRESSION]",blockType:"reporter",isTerminal:!0,arguments:{EXPRESSION:{type:"string",defaultValue:"smile",menu:"EXPRESSION"}}},{opcode:"affdexIsExpression",text:"expressing [EXPRESSION]",blockType:"Boolean",isTerminal:!0,arguments:{EXPRESSION:{type:"string",defaultValue:"smile",menu:"EXPRESSION"}}},{opcode:"affdexWhenEmotion",text:"when [EMOTION] feeling detected",blockType:"hat",isTerminal:!0,arguments:{EMOTION:{type:"string",defaultValue:"joy",menu:"EMOTION"}}},{opcode:"affdexEmotionAmount",text:"level of [EMOTION_ALL]",blockType:"reporter",isTerminal:!0,arguments:{EMOTION_ALL:{type:"string",defaultValue:"joy",menu:"EMOTION_ALL"}}},{opcode:"affdexIsTopEmotion",text:"feeling [EMOTION]",blockType:"Boolean",isTerminal:!0,arguments:{EMOTION:{type:"string",defaultValue:"joy",menu:"EMOTION"}}},{opcode:"videoToggle",text:"turn video [VIDEO_STATE]",arguments:{VIDEO_STATE:{type:"number",menu:"VIDEO_STATE",defaultValue:"off"}},blockType:"command"},{opcode:"setVideoTransparency",text:"set video transparency to [TRANSPARENCY]",arguments:{TRANSPARENCY:{type:"number",defaultValue:50}},blockType:"command"}],menus:{AFFDEX_POINT:{items:[{text:"left ear",value:"0"},{text:"left chin",value:"1"},{text:"chin",value:"2"},{text:"right chin",value:"3"},{text:"right ear",value:"4"},{text:"left outer eyebrow",value:"5"},{text:"left eyebrow",value:"6"},{text:"left inner eyebrow",value:"7"},{text:"right inner eyebrow",value:"8"},{text:"right eyebrow",value:"9"},{text:"right outer eyebrow",value:"10"},{text:"nose bridge",value:"11"},{text:"nose tip",value:"12"},{text:"left nostril",value:"13"},{text:"nose tip",value:"14"},{text:"right nostril",value:"15"},{text:"left outer eye crease",value:"16"},{text:"left inner eye crease",value:"17"},{text:"right inner eye crease",value:"18"},{text:"right outer eye crease",value:"19"},{text:"left mouth crease",value:"20"},{text:"left upper lip point",value:"21"},{text:"upper lip",value:"22"},{text:"right upper lip point",value:"23"},{text:"right mouth crease",value:"24"},{text:"right lower lip point",value:"25"},{text:"lower lip",value:"26"},{text:"left lower lip point",value:"27"},{text:"upper lip bottom",value:"28"},{text:"lower lip top",value:"29"},{text:"left upper eyelid",value:"30"},{text:"left lower eyelid",value:"31"},{text:"right upper eyelid",value:"32"},{text:"right lower eyelid",value:"33"}],acceptReporters:!1},EMOTION:{acceptReporters:!0,items:[{text:"joyful",value:"joy"},{text:"sad",value:"sadness"},{text:"disgusted",value:"disgust"},{text:"angry",value:"anger"},{text:"fearful",value:"fear"}]},EXPRESSION:{acceptReporters:!0,items:[{text:"smile",value:"smile"},{text:"mouth open",value:"mouthOpen"},{text:"eye closure",value:"eyeClosure"},{text:"eyebrow raise",value:"browRaise"},{text:"whistling",value:"lipPucker"},{text:"eye widening",value:"eyeWiden"},{text:"eyebrow furrow",value:"browFurrow"},{text:"nose wrinkle",value:"noseWrinkle"},{text:"upper lip raise",value:"upperLipRaise"},{text:"lip corner pull",value:"lipCornerDepressor"},{text:"chin raise",value:"chinRaise"},{text:"smirk",value:"smirk"},{text:"attention",value:"attention"},{text:"eyelid tighten",value:"lidTighten"},{text:"jaw drop",value:"jawDrop"},{text:"cheek dimple",value:"dimpler"},{text:"cheek raise",value:"cheekRaise"},{text:"lip stretch",value:"lipStretch"}]},EMOTION_ALL:{acceptReporters:!0,items:[{text:"joy",value:"joy"},{text:"sadness",value:"sadness"},{text:"disgust",value:"disgust"},{text:"contempt",value:"contempt"},{text:"anger",value:"anger"},{text:"fear",value:"fear"},{text:"surprise",value:"surprise"},{text:"valence",value:"valence"},{text:"engagement",value:"engagement"}]},ATTRIBUTE:{acceptReporters:!0,items:[{text:"motion",value:"motion"},{text:"direction",value:"direction"}]},SUBJECT:{acceptReporters:!0,items:[{text:"sprite",value:"this sprite"},{text:"stage",value:"Stage"}]},VIDEO_STATE:{acceptReporters:!0,items:[{text:"off",value:"off"},{text:"on",value:"on"},{text:"on flipped",value:"on-flipped"}]}}};t.legacy(i).for;const s=t.legacy(i,{incrementalDevelopment:!0}).for,{legacyExtension:a,legacyDefinition:o,ReservedNames:u}=s(),n=[480,360],r=0,l=1;function M(e){return parseFloat(Number(e).toFixed(2))}var c=(()=>{let e,s,u=[a()],c=[];var L,d,x;return s=class extends t.Extension{constructor(){super(...arguments,"Face Sensing","poseFace","data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDI0LjAuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIKCSBpZD0ic3ZnMTE3IiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKCSB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDQwIDQwIgoJIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDQwIDQwOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+CjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+Cgkuc3Qwe2ZpbGw6IzU2Q0JGNTt9Cgkuc3Qxe29wYWNpdHk6MC41NztmaWxsOiNFRTQwOTc7ZW5hYmxlLWJhY2tncm91bmQ6bmV3ICAgIDt9Cgkuc3Qye2ZpbGw6IzQ2OTFGRjt9Cgkuc3Qze2ZpbGw6IzM3NTI3Qjt9Cgkuc3Q0e29wYWNpdHk6MC40OTtmaWxsOiNFMDMwMEU7ZW5hYmxlLWJhY2tncm91bmQ6bmV3ICAgIDt9Cgkuc3Q1e29wYWNpdHk6MC40OTtmaWxsOiNCMjBEMjQ7ZW5hYmxlLWJhY2tncm91bmQ6bmV3ICAgIDt9Cgkuc3Q2e2ZpbGw6I0VERURFQjt9Cgkuc3Q3e2ZpbGw6I0NFQ0VDQzt9Cgkuc3Q4e2ZpbGw6I0ZGRkZGRjt9Cjwvc3R5bGU+Cjxzb2RpcG9kaTpuYW1lZHZpZXcgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IiBib3JkZXJvcGFjaXR5PSIxIiBncmlkdG9sZXJhbmNlPSIxMCIgZ3VpZGV0b2xlcmFuY2U9IjEwIiBpZD0ibmFtZWR2aWV3MTE5IiBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJFeHRlbnNpb25zL1NvZnR3YXJlL1ZpZGVvLVNlbnNpbmctQmxvY2siIGlua3NjYXBlOmN4PSIxNC40NjcwNjkiIGlua3NjYXBlOmN5PSI2LjU5MDMwNTYiIGlua3NjYXBlOmRvY3VtZW50LXJvdGF0aW9uPSIwIiBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMCIgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIgaW5rc2NhcGU6c25hcC1zbW9vdGgtbm9kZXM9ImZhbHNlIiBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSI5MDciIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjAiIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMTYwMCIgaW5rc2NhcGU6d2luZG93LXg9IjU3MSIgaW5rc2NhcGU6d2luZG93LXk9Ijk2IiBpbmtzY2FwZTp6b29tPSI3LjA0IiBvYmplY3R0b2xlcmFuY2U9IjEwIiBwYWdlY29sb3I9IiNmZmZmZmYiIHNob3dncmlkPSJmYWxzZSI+Cgk8L3NvZGlwb2RpOm5hbWVkdmlldz4KPHRpdGxlICBpZD0idGl0bGUxMDQiPkV4dGVuc2lvbnMvU29mdHdhcmUvVmlkZW8tU2Vuc2luZy1CbG9jazwvdGl0bGU+CjxkZXNjICBpZD0iZGVzYzEwNiI+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik05LjgsMjIuOWwtMS4xLTMuM2MtMC41LTEuNi0wLjgtMy4yLTAuOC00LjljMC02LjYsNS4zLTExLjksMTEuOS0xMS45czExLjksNS4zLDExLjksMTEuOQoJYzAsMS43LTAuMywzLjMtMC44LDQuOWwtMS4xLDMuM0g5Ljh6Ii8+CjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0xOS44LDUuMWMtMi40LDAtNC44LDAuOS02LjYsMi40YzEuMi0wLjUsMi41LTAuOCwzLjktMC44YzUuOCwwLDEwLjQsNC42LDEwLjQsMTAuNGMwLDEuNS0wLjMsMi45LTAuNyw0LjMKCWwtMC40LDEuMmgyLjJsMS0yLjljMC40LTEuNCwwLjctMi44LDAuNy00LjNDMzAuMiw5LjcsMjUuNiw1LjEsMTkuOCw1LjF6Ii8+CjxwYXRoIGNsYXNzPSJzdDIiIGQ9Ik0yNi4yLDMyLjlsLTMuNSwyLjljLTAuOCwwLjctMS44LDEtMi45LDFzLTIuMS0wLjMtMi45LTFsLTMuNS0yLjljLTEuMS0xLTEuOC0yLjQtMS45LTMuOGwtMC40LTYuNGwwLjctNwoJYzAuMy0yLjMsMi4xLTMuOSw0LjQtMy45aDcuNGMyLjMsMCw0LjEsMS43LDQuNCwzLjlsMC43LDdMMjguMiwyOUMyOC4xLDMwLjUsMjcuNCwzMS45LDI2LjIsMzIuOXoiLz4KPHBhdGggY2xhc3M9InN0MiIgZD0iTTI4LDE5LjloMS43YzAuNiwwLDEuMSwwLjUsMS4xLDEuMXYyLjdjMCwxLjUtMS4yLDIuNy0yLjcsMi43TDI4LDE5LjlMMjgsMTkuOXoiLz4KPHBhdGggY2xhc3M9InN0MiIgZD0iTTExLjYsMTkuOUg5LjljLTAuNiwwLTEuMSwwLjUtMS4xLDEuMXYyLjdjMCwxLjUsMS4yLDIuNywyLjcsMi43TDExLjYsMTkuOUwxMS42LDE5Ljl6Ii8+CjxwYXRoIGNsYXNzPSJzdDMiIGQ9Ik0yMS41LDI3aC0xLjd2LTZsMC4xLDAuMkMyMC4xLDIzLjIsMjAuOCwyNS4zLDIxLjUsMjd6Ii8+CjxwYXRoIGNsYXNzPSJzdDQiIGQ9Ik0xNi42LDMwLjJsMi4yLTEuMWwxLjEsMC41bDEuMS0wLjVsMi4yLDEuMUwyMSwzMS40aC0yLjJMMTYuNiwzMC4yeiIvPgo8cGF0aCBjbGFzcz0ic3Q1IiBkPSJNMjMuMSwzMC4yaC0wLjVDMjIuNywzMC4yLDIyLjksMzAuMywyMy4xLDMwLjJMMjMuMSwzMC4yeiIvPgo8cGF0aCBjbGFzcz0ic3Q1IiBkPSJNMjIuNiwzMC4yaC02bDIuMSwxQzE5LjgsMzAuNywyMS4yLDMwLjIsMjIuNiwzMC4yeiIvPgo8cGF0aCBjbGFzcz0ic3Q2IiBkPSJNMjEuNSwyMWwwLjctMC41YzAuNC0wLjMsMS4xLTAuNiwxLjgtMC42YzAuNywwLDEuMywwLjIsMS44LDAuNmwwLjcsMC41bC0wLjcsMC41Yy0wLjQsMC4zLTEuMSwwLjYtMS44LDAuNgoJYy0wLjcsMC0xLjMtMC4yLTEuOC0wLjZMMjEuNSwyMXoiLz4KPHBhdGggY2xhc3M9InN0NyIgZD0iTTI1LjcsMjAuNWMtMC40LTAuMy0xLjEtMC41LTEuNy0wLjVjLTAuNywwLTEuMywwLjItMS44LDAuNkwyMS41LDIxbDAuMiwwLjJDMjIuOSwyMC43LDI0LjMsMjAuNSwyNS43LDIwLjV6IgoJLz4KPHBhdGggY2xhc3M9InN0NiIgZD0iTTEzLjMsMjFsMC43LTAuNWMwLjQtMC4zLDEuMS0wLjYsMS44LTAuNmMwLjcsMCwxLjMsMC4yLDEuOCwwLjZsMC43LDAuNWwtMC43LDAuNWMtMC40LDAuMy0xLjEsMC42LTEuOCwwLjYKCWMtMC43LDAtMS4zLTAuMi0xLjgtMC42TDEzLjMsMjF6Ii8+CjxwYXRoIGNsYXNzPSJzdDciIGQ9Ik0xNy40LDIwLjVjLTAuNS0wLjMtMS4xLTAuNS0xLjctMC41Yy0wLjcsMC0xLjMsMC4yLTEuOCwwLjZMMTMuMywyMWwwLjMsMC4yQzE0LjcsMjAuNywxNi4xLDIwLjUsMTcuNCwyMC41CglMMTcuNCwyMC41eiIvPgo8cGF0aCBjbGFzcz0ic3QzIiBkPSJNMjcuOCwxNS42Yy0wLjEtMS4yLTAuOC0yLjQtMS43LTMuMXYwLjFsMC44LDcuNmwtMC40LDdjLTAuMSwxLjctMC45LDMuMS0yLjEsNC4ybC0zLjgsMy4xCgljLTEsMC45LTIuNCwxLjMtMy44LDEuMWwwLjEsMC4xYzEuNywxLjQsNC4xLDEuNCw1LjgsMGwzLjUtMi45YzEuMS0xLDEuOC0yLjQsMS45LTMuOGwwLjQtNi40TDI3LjgsMTUuNnoiLz4KPHBhdGggY2xhc3M9InN0OCIgZD0iTTIuMyw2LjRoNS42VjUuMkgxLjZDMS4zLDUuMiwxLDUuNSwxLDUuOHY2LjNoMS4zVjYuNHoiLz4KPHBhdGggY2xhc3M9InN0OCIgZD0iTTM3LjQsMTIuMWgxLjNWNS44YzAtMC4zLTAuMy0wLjYtMC42LTAuNmgtNi4zdjEuM2g1LjZWMTIuMXoiLz4KPHBhdGggY2xhc3M9InN0OCIgZD0iTTM3LjQsMzYuNWgtNS42djEuM0gzOGMwLjMsMCwwLjYtMC4zLDAuNi0wLjZ2LTYuM2gtMS4zdjUuNkgzNy40eiIvPgo8cGF0aCBjbGFzcz0ic3Q4IiBkPSJNMS42LDM3LjhoNi4zdi0xLjNIMi4zdi01LjZIMXY2LjNDMSwzNy41LDEuMywzNy44LDEuNiwzNy44eiIvPgo8L3N2Zz4K")}get expressionsReady(){return this.affdexState&&this.affdexState.expressions}get emotionsReady(){return this.affdexState&&this.affdexState.emotions}init(e){this.runtime.ioDevices&&this._loop()}projectStarted(){this.setTransparency(this.globalVideoTransparency),this.toggleVideo(this.globalVideoState)}convertCoordsToScratch({x:e,y:t}){return{x:e-n[0]/2,y:n[1]/2-t}}async _loop(){for(;;){const e=this.runtime.ioDevices.video.getFrame({format:"image-data",dimensions:n}),t=+new Date;e&&(this.affdexState=await this.estimateAffdexOnImage(e));const i=(+new Date-t)/4;await new Promise((e=>setTimeout(e,i)))}}isConnected(){return this.hasResult}async estimateAffdexOnImage(e){const t=await this.ensureAffdexLoaded(e);return t.process(e,0),new Promise(((e,i)=>{const s=function(i,a,o){t.removeEventListener("onImageResultsSuccess",s),i.length<1?e(null):e(i[0])};t.addEventListener("onImageResultsSuccess",s)}))}async ensureAffdexLoaded(e){if(this.affdexDetector)return this.affdexDetector;const i=await t.untilExternalGlobalVariableLoaded("https://download.affectiva.com/js/3.2.1/affdex.js","affdex"),s=new Promise(((t,s)=>{const a=n[0],o=n[1],u=i.FaceDetectorMode.LARGE_FACES,r=new i.PhotoDetector(e,a,o,u);r.detectAllEmotions(),r.detectAllExpressions(),r.start(),this.affdexDetector=r,r.addEventListener("onInitializeSuccess",t)}));return await s,this.affdexDetector}isTopEmotion(e,t){if(!this.emotionsReady)return!1;let i=-Number.MAX_VALUE,s=null;return t.forEach((e=>{const t=this.affdexState.emotions[e.value];t>i&&(i=t,s=e)})),e==s.value}toggleVideo(e){if(e===r)return this.runtime.ioDevices.video.disableVideo();this.runtime.ioDevices.video.enableVideo(),this.runtime.ioDevices.video.mirror=e===l}setTransparency(e){const t=Math.max(Math.min(e,100),0);this.runtime.ioDevices.video.setPreviewGhost(t)}defineBlocks(){this.globalVideoState=l,this.globalVideoTransparency=50,this.projectStarted();const e=i.menus.EXPRESSION.items.map((({value:e})=>e)),s={handler:i=>t.isString(i)&&e.includes(i)?i:"smile"},a=i.menus.EMOTION_ALL.items.map((({value:e})=>e)),{items:u}=i.menus.EMOTION,n={handler:e=>t.isString(e)&&a.includes(e)?e:"joy"},r=e=>!!this.expressionsReady&&this.affdexState.expressions[e]>.5;return{affdexGoToPart:o.affdexGoToPart({operation:(e,t)=>{if(!this.affdexState||!this.affdexState.featurePoints)return;const i=this.affdexState.featurePoints[e],{x:s,y:a}=this.convertCoordsToScratch(i);t.target.setXY(s,a,!1)}}),affdexWhenExpression:o.affdexWhenExpression({operation:r,argumentMethods:{0:s}}),affdexExpressionAmount:o.affdexExpressionAmount({operation:e=>this.expressionsReady?M(this.affdexState.expressions[e]):0,argumentMethods:{0:s}}),affdexIsExpression:o.affdexIsExpression({operation:r,argumentMethods:{0:s}}),affdexWhenEmotion:o.affdexWhenEmotion({operation:e=>this.isTopEmotion(e,u),argumentMethods:{0:n}}),affdexEmotionAmount:o.affdexEmotionAmount({operation:e=>this.emotionsReady?M(this.affdexState.emotions[e]):0,argumentMethods:{0:n}}),affdexIsTopEmotion:o.affdexIsTopEmotion({operation:e=>this.isTopEmotion(e,u),argumentMethods:{0:n}}),setVideoTransparency:o.setVideoTransparency({operation:e=>this.setTransparency(e)})}}},L=s,"symbol"==typeof(d="PoseFace")&&(d=d.description?"[".concat(d.description,"]"):""),Object.defineProperty(L,"name",{configurable:!0,value:x?"".concat(x," ",d):d}),function(e,t,i,s,a,o){function u(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var n,r=s.kind,l="getter"===r?"get":"setter"===r?"set":"value",M=!t&&e?s.static?e:e.prototype:null,c=t||(M?Object.getOwnPropertyDescriptor(M,s.name):{}),L=!1,d=i.length-1;d>=0;d--){var x={};for(var j in s)x[j]="access"===j?{}:s[j];for(var j in s.access)x.access[j]=s.access[j];x.addInitializer=function(e){if(L)throw new TypeError("Cannot add initializers after decoration has completed");o.push(u(e||null))};var w=(0,i[d])("accessor"===r?{get:c.get,set:c.set}:c[l],x);if("accessor"===r){if(void 0===w)continue;if(null===w||"object"!=typeof w)throw new TypeError("Object expected");(n=u(w.get))&&(c.get=n),(n=u(w.set))&&(c.set=n),(n=u(w.init))&&a.push(n)}else(n=u(w))&&("field"===r?a.push(n):c[l]=n)}M&&Object.defineProperty(M,s.name,c),L=!0}(null,e={value:s},u,{kind:"class",name:s.name},null,c),s=e.value,function(e,t,i){for(var s=arguments.length>2,a=0;a<t.length;a++)i=s?t[a].call(e,i):t[a].call(e)}(s,c),s})();return e.Extension=c,Object.defineProperty(e,"__esModule",{value:!0}),e}({},ExtensionFramework);//# sourceMappingURL=poseFace.js.map
